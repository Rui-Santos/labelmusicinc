function counterStyle(e){decPlaces=Math.pow(10,0);for(var a=["k","m","b","t"],t=a.length-1;t>=0;t--){var i=Math.pow(10,3*(t+1));if(e>=i){e=Math.round(e*decPlaces/i)/decPlaces,1e3==e&&t<a.length-1&&(e=1,t++),e="+"+e+a[t];break}}return e}function updatePlayListSize(){var e=$(".__playerplaylist ul li").length;return 200*e+10*e+5>window.innerWidth?window.innerWidth:200*e+10*e+5,$(".__playerplaylist ul").css({width:200*e+10*e+5+"px",minWidth:"100%"}),$(".__playerplaylist ul").parent().css({width:200*e+10*e+"px",minWidth:"100%"}),LMI.isMobile()?$(".__playerplaylist").css({overflowY:"hidden",overflowX:"auto",widtd:"100%",minWidth:"100%"}):$(".__playerplaylist").mCustomScrollbar("update"),e}function timeConverter(e){var a=new Date(e);e=a.getFullYear();var t=months[a.getMonth()],i=a.getDate();a.getHours(),a.getMinutes(),a.getSeconds();var l=new Date,a=months[l.getMonth()],o=l.getFullYear(),l=l.getDate();return e==o&&t==a&&i==l?"Hoy":e==o&&t==a&&l>1&&i==l-1?"Ayer":e==o&&t==a&&l>2&&l-1>i?"Este mes":e==o&&a>1&&t==a-1?"El mes padado":t+" "+i+", "+e}function validUsername(e){return un=/^[A-Za-z0-9_]{3,20}$/,un.test(e)}function validPassword(e){return un=/^[A-Za-z0-9!@#$%^&*()_.]{6,20}$/,un.test(e)}function urlify(e){return e.replace(/(https?:\/\/[^\s]+)/g,function(e){return'<a href="'+e+'">'+e+"</a>"})}var $player=$(".player-footer"),$playerClone=$(".player-footer-clone"),playerVisible,$modal=$(".modal"),$loader=$("._st_load"),nf="assets/image/bad.png",collection_open=!1,timer=null,doxhr=null,LMI=null,$playerAn=$("#playerWrapper"),downloading=!1,$body=$("body"),isPlaying=!1,months,$playlist=$(".__playerplaylist"),playlist,lastFilter,carouselInstance,choseOpen=[],$filemanager=jQuery(".filemanager .filelist");!function(e){function a(){var a;if(a=e(this),!a.data("streamdate")){a.data("streamdate",{datetime:l.datetime(a)});var i=e.trim(a.html());0<i.length&&a.attr("title",i)}return a=a.data("streamdate"),isNaN(a.datetime)||e(this).html(t(a.datetime)),this}function t(e){return l.inWords(i(e))}function i(e){return(new Date).getTime()-e.getTime()}e.streamdate=function(a){return a instanceof Date?t(a):"string"==typeof a?t(e.streamdate.parse(a)):t(e.streamdate.datetime(a))};var l=e.streamdate;e.extend(e.streamdate,{settings:{refreshMillis:1e3,allowFuture:!1,strings:{prefixAgo:"",prefixFromNow:null,suffixAgo:"",suffixFromNow:"de este momento",seconds:"hace unos segundos",minute:"hace un minuto",minutes:"hace %d minutos",hour:"hace una hora",hours:"hace %d horas",day:"hace un dia",days:"hace %d dias",month:"el mes pasado",months:"hace %d meses",year:"el a&ntilde;o pasado",years:"%d a&ntilde;os",numbers:[]}},inWords:function(a){function t(t,l){return(e.isFunction(t)?t(l,a):t).replace(/%d/i,i.numbers&&i.numbers[l]||l)}var i=this.settings.strings,l=i.prefixAgo,o=i.suffixAgo;this.settings.allowFuture&&0>a&&(l=i.prefixFromNow,o=i.suffixFromNow);var n=Math.abs(a)/1e3,s=n/60,r=s/60,c=r/24,d=c/365,n=45>n&&t(i.seconds,Math.round(n))||90>n&&t(i.minute,1)||45>s&&t(i.minutes,Math.round(s))||90>s&&t(i.hour,1)||24>r&&t(i.hours,Math.round(r))||48>r&&t(i.day,1)||30>c&&t(i.days,Math.floor(c))||60>c&&t(i.month,1)||365>c&&t(i.months,Math.floor(c/30))||2>d&&t(i.year,1)||t(i.years,Math.floor(d));return e.trim([l,n,o].join(" "))},parse:function(a){return a=e.trim(a),a=a.replace(/\.\d\d\d+/,""),a=a.replace(/-/,"/").replace(/-/,"/"),a=a.replace(/T/," ").replace(/Z/," UTC"),a=a.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(a)},datetime:function(a){return a="time"===e(a).get(0).tagName.toLowerCase()?e(a).attr("datetime"):e(a).attr("title"),l.parse(a)}}),e.fn.streamdate=function(){var e=this;e.each(a);var t=l.settings;return 0<t.refreshMillis&&setInterval(function(){e.each(a)},t.refreshMillis),e},document.createElement("abbr"),document.createElement("time")}(jQuery),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.unpush=function(e,a){var t=this.slice((a||e)+1||this.length);return this.length=0>e?this.length+e:e,this.push.apply(this,t)},months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var notificationTimer,notificationTimeout=5e3,Notifications={get:function(e){return jQuery(e)},create:function(e,a){Notifications.clear(notificationTimer);var t=jQuery(".errorpanel").length+1,i=jQuery('<div class="errorpanel" id="notification-'+t+'" />'),l='<button type="button" class="close"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>';return i.removeClass("success notify"),void 0!=a&&"boolean"==typeof a&&a?i.addClass("success"):void 0!=a&&1==a&&i.addClass("notify"),jQuery(".errorpanel").addClass("white"),i.html('<div class="containers">'+l+e+"</div>").css({top:-100,opacity:0}),Notifications.get("body").append(i),notificationTimer=setTimeout(function(){i.css({top:0,opacity:1}).removeClass("white"),notificationTimer=setTimeout(function(){if(void 0!=a&&"object"==typeof a)for(var e in a)"class"==a[e][0]?Notifications.get(".errorpanel").addClass(a[e][1]):Notifications.get(".errorpanel").attr(a[e][0],a[e][1]);Notifications.clear(notificationTimer),notificationTimer=setTimeout(function(){Notifications.close()},notificationTimeout)},500)},100),e},clear:function(e){clearTimeout(e)},close:function(){Notifications.clear(notificationTimer),Notifications.get(".errorpanel").css({opacity:0,right:"-100%"}),notificationTimer=setTimeout(function(){Notifications.get(".errorpanel").remove(),Notifications.clear(notificationTimer)},500)}};if(Notifications.get("body").on("click",".errorpanel .close",function(){Notifications.close()}),jQuery("body").find('[rel="notify"]').length>0){var d_msg=jQuery("body").find('[rel="notify"]').attr("data-notification-message"),d_attr=void 0!=jQuery("body").find('[rel="notify"]').attr("data-notification-attributes")?jQuery("body").find('[rel="notify"]').attr("data-notification-attributes"):!1,d_attr="true"==d_attr?!0:d_attr;d_attr?Notifications.create(d_msg,d_attr):Notifications.create(d_msg)}var LMI={};LMI={path:null,link:null,values:{categories:$('[name="lmi-categories"]',$body).val().split(","),session:"false",owner:0,owner_name:null},setCookie:function(e,a){var t=new Date;t.setTime(t.getTime()+864e5);var i="expires="+t.toGMTString();document.cookie=e+"="+a+"; "+i+"; path=/labelmusicinc/;"},getCookie:function(e){for(var a=e+"=",t=document.cookie.split(";"),i=0;i<t.length;i++){var l=t[i].trim();if(0==l.indexOf(a))return l.substring(a.length,l.length)}return""},newCollection:function(){var e=$("#_cover_value"),a=$("#_title");$("#song_count"),void 0==e.val()||0==e.val().length||" "==e.val(),void 0==a.val()||"Sin titulo"!=a.val()||0==a.val().length||" "==a.val()},fetchCollections:function(){$("body").find(".fetch_collections").each(function(){var e=void 0!=$(this).attr("data-params")?$(this).attr("data-params"):"all,0,10",e=e.split(","),a=[];e.length>0&&(a[0]=void 0!=e[0]?e[0]:"all",a[1]=void 0!=e[1]?e[1]:0,a[2]=void 0!=e[2]?e[2]:10),$loader.addClass("loading");var t=$(this);t.addClass("preloading").css({minHeight:50}),setTimeout(function(){$.ajax({url:LMI.path+"../api.php?collections&view="+a[0]+"&from="+a[1]+"&to="+a[2],success:function(e){if(console.log(e),t.empty().removeClass("preloading"),void 0!=e.status)t.append('<div class="alert alert-info">No hay colecciones.</div>');else{var a='<ul style="list-style: none"><h3 class="visible-xs text-muted text-center">Talvez te interese</h3>';for(i=0;i<e.length;i++){var l=i>1?" hidden-xs":"";e[i].fullname=e[i].fullname.indexOf(" ")>-1?e[i].fullname.split(" "):[e[i].fullname," "],a+='<li class="'+l+' visible-xs col-sm-6 col-md-4"><div class="col-xs-12"><a href="'+LMI.link+"colecciones/coleccion/"+e[i].id+'/"><span class="pull-left"><img src="'+LMI.path+"../usercontent/media/"+e[i].user_id+"/thumb_"+e[i].cover_url+'"></span><strong class="_title">'+e[i].name+"</strong><small>Por <strong>"+e[i].fullname[0]+'</strong></small><span class="clearfix"></span></a></div><span class="clearfix"></span></li>';var o="col-sm-4 col-md-4 hidden-xs";a+='<div class="'+o+' __feature_oi __content_collection"><div class="col-xs-12"><div class="__feature_oi_cover"><a href="'+LMI.link+"colecciones/coleccion/"+e[i].id+'"><div class="__feature_oi_img"><img src="'+LMI.path+"../usercontent/media/"+e[i].user_id+"/small_"+e[i].cover_url+'"></div></a><div class="__feature_oi_info"><a href="'+LMI.link+"colecciones/coleccion/"+e[i].id+'" class="__linker"></a><div class="__b_a"><small class="text-muted">'+e[i].numb+" canciones</small><br />"+e[i].name+"<br /><small>"+LMI.values.categories[e[i].category]+'</small><br /><span class="btn btn-trans btn-xs">LEER MAS</span></div></div></div></div></div>'}a+="</ul>",t.append(a)}$loader.removeClass("loading")}})},500)})},filemanager:{init:function(){var e=jQuery("body").attr("data-action");e.indexOf("_hash_tracks")>-1?LMI.filemanager.loadSongs():LMI.filemanager.loadCollections(),LMI.filemanager.enable()},loadSongs:function(){var e='<p class="text-muted col-xs-12">Parece que no tienes contenidos.</p>',a="",t=document.getElementById("filetemplate").innerHTML,l=$("<div />");l.html(t),$(".stracks").addClass("btn-secondary").removeClass("btn-cancel"),$(".scollections").addClass("btn-cancel").removeClass("btn-secondary"),$("#contenttype").val("tracks"),$(".fileactions").find(".btn").addClass("disabled btn-cancel").removeClass("btn-success").attr("disabled","disabled").attr("href","javascript:;");var o=$filemanager.hasClass("filecompact")?6:12;$.ajax({url:LMI.link+"api.php?collections&view=filter:songs.user-"+LMI.values.owner+"&from=0&to="+o,success:function(t){if(t.length>0){for(t.length==o&&jQuery(".loadmore").show(),i=0;i<t.length;i++)a+=l.html().replace(/{{type}}/g,"track").replace(/{{link\.type}}/g,"song").replace(/{{link}}/g,LMI.link).replace(/{{icon}}/g,'<i class="ion-music-note icon"></i>').replace(/{{details}}/g,(t[i].filesize/1024/1024).toFixed(2)+' mb<span class="hidden-xs"> &bull; '+LMI.values.categories[t[i].category]+"</span>").replace(/{{id}}/g,t[i].id).replace(/{{name}}/g,t[i].filename);$filemanager.html(a),$filemanager.hasClass("filecompact")&&($filemanager.append('<li class="divider"></li><li><a href="'+LMI.link+'filemanager#tracks">Ver todo</a></li>'),$filemanager.prepend('<li class="header"><a href="javascript:;" class="col-xs-6 active" style="clear: none;">Tracks</a><a href="javascript:;" onmouseover="$(this).parent().addClass(\'active\').siblings().removeClass(\'active\');LMI.filemanager.loadCollections();" class="col-xs-6" style="clear: none;">Colecciones</a></li><span class="clearfix"></span><li class="divider"></li>'))}else $filemanager.html(e),$filemanager.hasClass("filecompact")&&$filemanager.append('<li class="divider"></li><li><a href="'+LMI.link+'filemanager#tracks">Ver todo</a></li>')}})},removeSong:function(e){$.ajax({url:LMI.link+"user.interactions.php?profile&view="+e+"&do=removesong",contentType:"application/json",success:function(){jQuery(".removing").remove(),Notifications.create("Track removida.",!0)}})},openCollection:function(){},enable:function(){jQuery("body").on("click",".file-item",function(){var e=$(this),a={id:e.attr("data-id"),isCollection:function(){return e.hasClass("collection")?!0:!1}};e.toggleClass("active").siblings().removeClass("active"),e.hasClass("active")?($(".fileactions").find(".btn").removeClass("disabled btn-cancel").addClass("btn-success").removeAttr("disabled"),LMI.filemanager.openCollection(a.id),a.isCollection()?($(".link-open").attr("href",LMI.link+"colecciones/coleccion/"+a.id).addClass("open-collection"),$(".link-edit").attr("href",LMI.link+"colecciones/editar/coleccion-"+a.id),$(".link-remove").attr("href",LMI.link+"colecciones/eliminar/coleccion-"+a.id)):($(".link-open").attr("href",LMI.link+"colecciones/song/"+a.id).removeClass("open-collection"),$(".link-edit").attr("href",LMI.link+"colecciones/editar/cancion-"+a.id),$(".link-remove").attr("href",LMI.link+"colecciones/eliminar/cancion-"+a.id))):$(".fileactions").find(".btn").addClass("disabled btn-cancel").removeClass("btn-success").attr("disabled","disabled").attr("href","javascript:;")}).on("click",".stracks",function(){"tracks"!=$("#contenttype").val()&&LMI.filemanager.loadSongs()}).on("click",".scollections",function(){"collections"!=$("#contenttype").val()&&LMI.filemanager.loadCollections()}).on("click",".loadmore",function(){LMI.filemanager.loadMore()})},loadMore:function(){var e=$(".file-item").length,a="",t=document.getElementById("filetemplate").innerHTML,l=$("<div />");l.html(t),"collections"==$("#contenttype").val()?$.ajax({url:LMI.link+"api.php?collections&view="+LMI.values.owner+"&from="+e+"&to=12",success:function(e){if(e.length>0){for(12==e.length?jQuery(".loadmore").show():jQuery(".loadmore").hide(),i=0;i<e.length;i++)a+=l.html().replace(/{{type}}/g,"collection").replace(/{{icon}}/g,'<img src="'+LMI.link+"usercontent/media/"+LMI.values.owner+"/thumb_"+e[i].cover_url+'" class="img-responsive" />').replace(/{{details}}/g,e[i].numb+" tracks").replace(/{{id}}/g,e[i].id).replace(/{{name}}/g,e[i].name);$filemanager.append(a)}else jQuery(".loadmore").hide()}}):$.ajax({url:LMI.link+"api.php?collections&view=filter:songs.user-"+LMI.values.owner+"&from="+e+"&to=12",success:function(e){if(e.length>0){for(12==e.length?jQuery(".loadmore").show():jQuery(".loadmore").hide(),i=0;i<e.length;i++)a+=l.html().replace(/{{type}}/g,"track").replace(/{{icon}}/g,'<i class="ion-music-note icon"></i>').replace(/{{details}}/g,(e[i].filesize/1024/1024).toFixed(2)+' mb<span class="hidden-xs"> &bull; '+LMI.values.categories[e[i].category]+"</span>").replace(/{{id}}/g,e[i].id).replace(/{{name}}/g,e[i].filename);$filemanager.append(a)}else jQuery(".loadmore").hide()}})},loadCollections:function(){var e='<p class="text-muted col-xs-12">Parece que no tienes contenidos.</p>',a="",t=document.getElementById("filetemplate").innerHTML,l=$("<div />");l.html(t),$(".scollections").addClass("btn-secondary").removeClass("btn-cancel"),$(".stracks").removeClass("btn-secondary").addClass("btn-cancel"),$("#contenttype").val("collections"),$(".fileactions").find(".btn").addClass("disabled btn-cancel").removeClass("btn-success").attr("disabled","disabled").attr("href","javascript:;");var o=$filemanager.hasClass("filecompact")?6:12;$.ajax({url:LMI.link+"api.php?collections&view="+LMI.values.owner+"&from=0&to="+o,success:function(t){if(t.length>0){for(t.length==o&&jQuery(".loadmore").show(),i=0;i<t.length;i++)a+=l.html().replace(/{{type}}/g,"collection").replace(/{{link\.type}}/g,"coleccion").replace(/{{link}}/g,LMI.link).replace(/{{icon}}/g,'<img src="'+LMI.link+"usercontent/media/"+LMI.values.owner+"/thumb_"+t[i].cover_url+'" class="img-responsive" />').replace(/{{details}}/g,t[i].numb+" tracks").replace(/{{id}}/g,t[i].id).replace(/{{name}}/g,t[i].name);$filemanager.html(a),$filemanager.hasClass("filecompact")&&($filemanager.append('<li class="divider"></li><li><a href="'+LMI.link+'filemanager">Ver todo</a></li>'),$filemanager.prepend('<li class="header"><a href="javascript:;" class="col-xs-6" onmouseover="$(this).parent().addClass(\'active\').siblings().removeClass(\'active\');LMI.filemanager.loadSongs();"  style="clear: none;">Tracks</a><a href="javascript:;" class="col-xs-6 active" style="clear: none;">Colecciones</a></li><span class="clearfix"></span><li class="divider"></li>'))}else $filemanager.html(e),$filemanager.hasClass("filecompact")&&$filemanager.append('<li class="divider"></li><li><a href="'+LMI.link+'filemanager#tracks">Ver todo</a></li>')}})}},fetchComments:function(e){var a=void 0!=e.attr("data-from")?e.attr("data-from").split(","):[];if(a.length>0){var t=0;a[0].indexOf("song-id")>-1?t=1:a[0].indexOf("collection-id")>-1&&(t=0);var l=a[0].split("::"),o=l[1],n=e,s=n.find("li").length;$.ajax({url:""+LMI.path+"../api.php?comments&view="+o+"&type="+t+"&from="+s+"&to="+10,success:function(e){if(console.log(e),0==n.find("ul").length&&n.empty(),void 0!=e.status)0==n.find("ul").length&&n.append('<div class="alert alert-info">No hay comentarios.</div>'),n.find(".load-more-button").length>0&&(n.find(".load-more-button").find("a").text("No hay mas contenidos..."),setTimeout(function(){n.find(".load-more-button").remove()},500));else{var a=n.find("ul").length>0?"":"<ul>";for(i=0;i<e.length;i++){e[i].comment_body=e[i].comment_body.replace(/\n/g,"<br />"),e[i].comment_body=urlify(e[i].comment_body);var t=e[i].user_profile_picture;a+='<li id="comment_'+e[i].comment_id+'" data-id="'+e[i].comment_id+'" data-content-type="'+e[i].comment_content_type+'"><div class="col-xs-12 _pad"><a href="'+LMI.link+"@"+e[i].user_username+'" class="pull-left tooltip-t" title="perfil de '+e[i].user_fullname+'"><img src="'+t+'" class="_user_profile_photo_rounded" /></a><div class="comment_wrapper"><h4><a href="'+LMI.link+"@"+e[i].user_username+'">'+e[i].user_fullname+'</a> dijo: <span class="pull-right"><a href="javascript:;" class="comment_cog tooltip-t" title="Reportar"><i class="fa fa-cog"></i></a></span></h4><p>'+e[i].comment_body+'</p></div></div><span class="clearfix"></span></li>'}a+=n.find("ul").length>0?"":"</ul>",e.length>9&&(a+='<div class="text-center load-more-button"><a href="javascript:;" class="btn btn-primary">Cargar m&aacute;s</a></div>'),n.find("ul").length>0?(n.find(".load-more-button").length>0&&n.find(".load-more-button").remove(),n.find("ul").append(a)):n.append(a)}}})}},coverflow:function(){var e=$("body").find("._coverflow ul li");e.length>0&&(e.eq(0).addClass("current active"),e.eq(1).addClass("current next")),timer=setInterval(function(){var a=$("body").find("._coverflow ul li.active").index();e.last().index()==a?(e.removeClass("current prev next active"),setTimeout(function(){e.eq(0).addClass("current active"),e.eq(1).addClass("current next")},500)):$("body").find("._coverflow ul li.next").click()},5e3),$("body").on("click","._coverflow li.next",function(e){e.preventDefault(),e.stopPropagation(),$(this).addClass("active").removeClass("next"),$(this).prev().removeClass("active").addClass("prev"),$(this).prev().prev().removeClass("current prev active"),$(this).next().addClass("current next"),clearInterval(timer);var a=$("body").find("._coverflow ul li");timer=setInterval(function(){var e=$("body").find("._coverflow ul li.active").index();a.last().index()==e?(a.removeClass("current prev next active"),setTimeout(function(){a.eq(0).addClass("current active"),a.eq(1).addClass("current next")},500)):$("body").find("._coverflow ul li.next").click()},5e3)}).on("click","._coverflow li.prev",function(e){e.preventDefault(),e.stopPropagation(),$(this).addClass("active").removeClass("prev"),$(this).next().removeClass("active").addClass("next"),$(this).next().next().removeClass("current next active"),$(this).prev().addClass("current prev"),clearInterval(timer);var a=$("body").find("._coverflow ul li");timer=setInterval(function(){var e=$("body").find("._coverflow ul li.active").index();a.last().index()==e?(a.removeClass("current prev next active"),setTimeout(function(){a.eq(0).addClass("current active"),a.eq(1).addClass("current next")},500)):$("body").find("._coverflow ul li.next").click()},5e3)}).on("click","._coverflow li.active",function(e){e.preventDefault(),e.stopPropagation(),clearInterval(timer);var a=$(this).find("a").attr("href");$(this).addClass("clicked"),setTimeout(function(){Pace.restart(),$.ajax({url:a+"/ajax/",success:function(e){$(".pageContainer").html(e),setTimeout(function(){window.location=a},500)}})},500)})},isMobile:function(){var e=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase())||window.innerWidth<767?!0:!1;return e},postComment:function(e){var a=e.closest("._comment_box"),t=a.find("._comment_text"),i=a.find("._comment_box_hidden"),l=t.attr("data-original-value"),o=i.find("input").eq(0).val(),n=i.find("input").eq(1).val(),s=i.find("input").eq(2).val(),r=(i.find("input").eq(3).val(),t.serialize().replace("_comment_text","").replace("form-control=","")),c="user_id="+o+"&content_id="+n+"&content_type="+s+"&comment="+r;t.val()==l?(t.focus(),e.button("reset")):$.ajax({url:""+LMI.path+"../api.php?postComment",type:"post",data:c,success:function(a){t.val(""),e.button("reset"),console.log(a);var i="";a.comment_body=a.comment_body.replace(/\n/g,"<br />"),a.comment_body=urlify(a.comment_body),i+='<li id="comment_'+a.comment_id+'" data-id="'+a.comment_id+'" style="display: none"><div class="col-xs-12 _pad"><a href="'+LMI.link+"@"+a.user_username+'" class="pull-left tooltip-t" title="perfil de '+a.user_fullname+'"><img src="'+a.user_profile_picture+'" class="_user_profile_photo_rounded" /></a><div class="comment_wrapper"><h4><a href="'+LMI.link+"@"+a.user_username+'">'+a.user_fullname+'</a> dijo: <span class="pull-right"><a href="javascript:;" class="comment_cog tooltip-t" title="Reportar"><i class="fa fa-cog"></i></a></span></h4><p>'+a.comment_body+'</p></div></div><span class="clearfix"></span></li>',$("body").find(".activity_feed").find("ul").length>0?$("body").find(".activity_feed").find("ul").prepend(i):($("body").find(".activity_feed").empty(),$("body").find(".activity_feed").prepend("<ul>"+i+"</ul>")),setTimeout(function(){"WebkitTransform"in document.body.style||"MozTransform"in document.body.style||"OTransform"in document.body.style||"transform"in document.body.style?($("body").find(".activity_feed").find("ul").find("li").first().css({display:"block",opacity:0}),setTimeout(function(){$("body").find(".activity_feed").find("ul").find("li").first().css({opacity:.9})},100)):$("body").find(".activity_feed").find("ul").find("li").first().slideDown(),Notifications.create("Comentario publicado correctamente.",!0)},10)}})},loadEditionCollections:function(){var e='<li><div class="container_in_song"><span class="pull-left song_n"><i class="ion-close icon remove-from-collection tooltip-t" title="Eliminar" data-id="{{id}}" data-placement="top"></i> <i class="song_n_n">{{index}}</i> </span><a href="'+LMI.link+'colecciones/song/{{id}}" target="_blank" class="_song_name" title="{{name}}">'+"{{name}}"+'</a> <span class="clearfix"></span></div></li>',a=$(".collection_edition ul"),t='<span class="clearfix"></span><a href="'+LMI.link+"addsong"+'" class="btn btn-default btn-lg"><i class="ion-plus"></i> Agregar tracks</a>';collection_id=$(".collection_edition").attr("data-id"),$.ajax({url:LMI.link+"api.php?collection&view="+collection_id,success:function(i){if(console.log(i),void 0!=i.songs&&i.songs.length>0){var l="";for(z=0;z<i.songs.length;z++){var o=e,n=z+1;l+=o.replace(/{{id}}/g,i.songs[z].id).replace(/{{index}}/g,n).replace(/{{name}}/g,i.songs[z].filename)}a.html(l),a.append(t)}else a.html("No hay tracks en en esta colecci&oacute;n."),a.append(t)}})},fetchCollection:function(e,a,t){"notfired"==a&&($loader.addClass("loading"),t.find("img").attr("src",""+LMI.path+"image/0_.png").addClass("preloading"),$("._song_view_collection_list").find("img").attr("src",""+LMI.path+"image/0_.png").addClass("preloading"),$.ajax({url:""+LMI.path+"../api.php?collection&view="+e,success:function(e){console.log(e),setTimeout(function(){$.ajax({url:""+LMI.path+"../usercontent/media/"+e.user_id+"/medium_"+e.cover_url,success:function(){$("._song_view_collection_list").find("img").attr("src",""+LMI.path+"../usercontent/media/"+e.user_id+"/medium_"+e.cover_url).removeClass("preloading"),t.find("img").attr("src",""+LMI.path+"../usercontent/media/"+e.user_id+"/thumb_"+e.cover_url).removeClass("preloading")}}).fail(function(){$.ajax({url:""+LMI.path+"../usercontent/media/"+e.user_id+"/small_"+e.cover_url,success:function(){$("._song_view_collection_list").find("img").attr("src",""+LMI.path+"../usercontent/media/"+e.user_id+"/small_"+e.cover_url).removeClass("preloading"),t.find("img").attr("src",""+LMI.path+"../usercontent/media/"+e.user_id+"/thumb_"+e.cover_url).removeClass("preloading")}}).fail(function(){$("._song_view_collection_list").find("img").attr("src",nf).removeClass("preloading"),t.find("img").attr("src",""+LMI.path+"../usercontent/media/"+e.user_id+"/thumb_"+e.cover_url).removeClass("preloading")})}),$(".collection_s").text(e.name);var a="";for(i=0;i<e.songs.length;i++)a=a+'<li><a href="'+LMI.link+"colecciones/song/"+e.songs[i].id+'/">'+e.songs[i].filename.replace("\\ufff","&ntilde;")+"</a></li>";$("._song_view_collection_list ul .items-ul").html(a);var l=308*$("._song_view_collection_list ul li").length;LMI.isMobile()?$("._song_view_collection_list .items-ul li").addClass("col-xs-6"):($(".__scrollable_w,.__scrollable_wx,.__scrollable_b").mCustomScrollbar("update"),$("._song_view_collection_list .items-ul").css({width:l+"px"})),$loader.removeClass("loading"),t.attr("data-status","fired")},500)}}))},playlist:{gen:function(){playlist=LMI.playlist.getList(),$playlist.find("li").removeClass("playing");var e="";for(i=0;i<playlist.songs.length;i++)e+='<li data-song-id="'+playlist.songs[i].song_id+'" data-title="'+playlist.songs[i].title+'" data-url="'+playlist.songs[i].url+'" data-collection="'+playlist.songs[i].collection_id+'" data-duration="'+playlist.songs[i].duration+'" data-user-id="'+playlist.songs[i].autor_id+'" data-user-name="'+playlist.songs[i].autor_name+'">'+'<a href="javascript:;" class="remove-song pull-right">&times;</a>'+'<a href="javascript:;" class="songdata"></a>'+'<a href="javascript:;" class="play-song pull-left"><i class="ion-play"></i><i class="ion-pause"></i></a>'+'<a class="songinfo" href="'+LMI.link+"colecciones/song/"+playlist.songs[i].song_id+'">'+playlist.songs[i].title+"</a>"+"<small>"+playlist.songs[i].duration+' <a href="'+LMI.link+"@"+playlist.songs[i].autor_id+'">'+playlist.songs[i].autor_name+"</a></small>"+"</li>";return $playlist.find("ul").append(e),LMI.player.set("refresh"),playlist.songs.length},getList:function(){return null==playlist&&(playlist=""!=LMI.getCookie("playlist-"+LMI.values.owner)?jQuery.parseJSON(decodeURI(LMI.getCookie("playlist-"+LMI.values.owner))):{songs:[]}),playlist},save:function(){var e=encodeURI(JSON.stringify(playlist));LMI.setCookie("playlist-"+LMI.values.owner,e,360),Notifications.create("Lista de reproduccion guardada.",!0)},add:function(e,a,t,l,o,n,s){if(console.log("add song #"+e+" to playlist"),playlist=LMI.playlist.getList(),playlist.songs.length>0){playlist.owner=LMI.owner;var r,c=!1;for(i=0;i<playlist.songs.length;i++)playlist.songs[i].song_id==e&&(c=!0),r=i;if(c)$playlist.find('[data-song-id="'+e+'"]').length>0&&$playlist.find('[data-song-id="'+e+'"]').addClass("playing").siblings().removeClass("playing");else{playlist.songs.push({song_id:e,title:a,url:t,collection_id:l,duration:o,autor_id:n,autor_name:s}),$playlist.find("li").removeClass("playing");var d="";d+='<li data-song-id="'+e+'" data-title="'+a+'" data-url="'+t+'" data-collection="'+l+'" data-duration="'+o+'" data-user-id="'+n+'" data-user-name="'+s+'" class="playing">'+'<a href="javascript:;" class="remove-song pull-right">&times;</a>'+'<a href="javascript:;" class="songdata"></a>'+'<a href="javascript:;" class="play-song pull-left"><i class="ion-play"></i><i class="ion-pause"></i></a>'+'<a class="songinfo" href="'+LMI.link+"colecciones/song/"+e+'">'+a+"</a>"+"<small>"+o+' <a href="'+LMI.link+"@"+n+'">'+s+"</a></small>"+"</li>",$playlist.find("ul").append(d),LMI.player.set("refresh"),console.log("add html item"),Notifications.create(a+" agregada a la lista de reproduccion.",!0)}LMI.playlist.save()}else{playlist={},playlist.owner=LMI.owner,playlist.songs=[],playlist.songs.push({song_id:e,title:a,url:t,collection_id:l,duration:o,autor_id:n,autor_name:s}),$playlist.find("li").removeClass("playing");var d="";d+='<li data-song-id="'+e+'" data-title="'+a+'" data-url="'+t+'" data-collection="'+l+'" data-duration="'+o+'" data-user-id="'+n+'" data-user-name="'+s+'" class="playing">'+'<a href="javascript:;" class="remove-song pull-right">&times;</a>'+'<a href="javascript:;" class="songdata"></a>'+'<a href="javascript:;" class="play-song pull-left"><i class="ion-play"></i><i class="ion-pause"></i></a>'+'<a class="songinfo" href="'+LMI.link+"colecciones/song/"+e+'">'+a+"</a>"+"<small>"+o+' <a href="'+LMI.link+"@"+n+'">'+s+"</a></small>"+"</li>",$playlist.find("ul").append(d),LMI.player.set("refresh"),console.log("add html item"),LMI.playlist.save()}}},player:{set:function(e){switch(e){case"play":$playerAn.jPlayer("play");break;case"pause":$playerAn.jPlayer("pause"),Notifications.create("Reproduccion pausada. <a href=\"javascript:LMI.player.set('play');\">Reanudar</a>",1);break;case"refresh":return updatePlayListSize();case"stop":Notifications.create("Reproduccion detenida.",1),$playerAn.jPlayer("stop")}},volumerController:function(){var e=$("#volumeslider"),a=$(".tooltip");a.hide(),e.slider({range:"min",min:0,value:100,start:function(){a.fadeIn("fast")},slide:function(t,i){var l=e.slider("value"),o=$(".volume");$playerAn.jPlayer("volume",l/100),a.css("left",l).text(i.value),5>=l?o.css("background-position","0 0"):25>=l?o.css("background-position","0 -25px"):75>=l?o.css("background-position","0 -50px"):o.css("background-position","0 -75px")},stop:function(){a.fadeOut("fast");var t=e.slider("value");$playerAn.jPlayer("volume",t/100)}})}},defaultSong:function(){$playerAn.jPlayer("setMedia",{title:"Nombre de cancion es?",mp3:"http://localhost/labelmusicinc/usercontent/media/1/o_18ovl3jvu30t1dcj158j1sui4c31c.mp3"}),LMI.player.set("play")},setSong:function(e,a,t,i,l,o,n){$playerAn.jPlayer("setMedia",{title:e,mp3:a}),$player.find(".songtitle").parent().attr("href",LMI.link+"colecciones/song/"+i),$(".__player_progress_bg_progress").css({width:"0%"}),LMI.setCookie("playing_song_title",e,360),LMI.setCookie("playing_song_url",a,360),LMI.setCookie("playing_song_collection_id",t,360),LMI.setCookie("playing_song_id",i,360),LMI.setCookie("playing_duration",l,360),LMI.setCookie("playing_autor_id",o,360),LMI.setCookie("playing_autor_name",n,360),LMI.playlist.add(i,e,a,t,l,o,n),LMI.player.set("play")},getCurrentSong:function(){return{title:LMI.getCookie("playing_song_title"),url:LMI.getCookie("playing_song_url"),collection_id:LMI.getCookie("playing_song_collection_id"),song_id:LMI.getCookie("playing_song_id")}},initPlayer:function(){$playerAn.jPlayer({ready:function(){console.log("player ready")},timeupdate:function(e){$player.find(".__player_progress_bg").css({width:e.jPlayer.status.currentPercentAbsolute+"%"}),$player.find(".__player_progress_knob").css({marginLeft:e.jPlayer.status.currentPercentAbsolute+"%"});var a=Math.floor(e.jPlayer.status.currentTime/60),t=parseInt(e.jPlayer.status.currentTime-60*a);t=1==new String(t).length?"0"+t:t;var i=a+":"+t;$player.find(".durationcurrent").text(i);var l=Math.floor(e.jPlayer.status.duration/60),o=parseInt(e.jPlayer.status.duration-60*l);o=1==new String(o).length?"0"+o:o;var n=l+":"+o;$player.find(".durationtotal").text(n)},seeking:function(e){$player.find(".__player_progress_knob").css({marginLeft:e.jPlayer.status.seekPercent+"%"})},play:function(e){$player.addClass("playing"),console.log(e.jPlayer.status);var a=LMI.getCurrentSong();$(".playing").removeClass("playing"),$('[data-song-id="'+a.song_id+'"]').addClass("playing"),Notifications.create("Reproduciendo: "+a.title,1),$playlist.find("li").length>0?LMI.isMobile()?$.pageslide({href:"#playlistplayer",modal:!0}):$(".__playerplaylist.__scrollable_wx").mCustomScrollbar("scrollTo",$(".playlistplayer .playing").position().left):LMI.player.set("stop"),"false"==LMI.values.session&&($(".modal .modal-dialog").removeClass("modal-lg"),$.ajax({url:""+LMI.path+"../user.interactions.php?offline&do=login",success:function(e){$(".modal .modal-content").html(e),$(".modal").modal()}}))},pause:function(){$player.removeClass("playing"),$(".__feature_feed [data-song-id]").removeClass("playing");var e=LMI.getCurrentSong();$('[data-song-id="'+e.song_id+'"]').removeClass("playing")},stop:function(){Notifications.create("Reproduccion detenida.",1)},ended:function(){$player.removeClass("playing");var e=LMI.getCurrentSong();if(playlist.songs.length>0){var a=$playlist.find('li[data-url="'+e.url+'"]').index();$playlist.find("li").length>a&&$playlist.find("li").eq(a).next().find(".play-song").trigger("click")
}"false"==LMI.values.session&&($(".modal .modal-dialog").removeClass("modal-lg"),$.ajax({url:""+LMI.path+"../user.interactions.php?offline&do=login",success:function(e){$(".modal .modal-content").html(e),$(".modal").modal()}}))},progress:function(e){var a=e.jPlayer.status.seekPercent;$(".__player_progress_bg_progress").css({width:a+"%"})},volumechange:function(){},error:function(){playlist=LMI.playlist.getList(),playlist.songs.length>0?$playlist.find("li").first().find(".play-song").trigger("click"):$player.find(".songtitle").text("No hay canciones en cola de reproduccion."),Notifications.create("No se pudo reproducir porque tu lista de reproduccion esta vacia.")},errorAlerts:!0,swfPath:LMI.path+"plugins/player/",supplied:"mp3",wmode:"window",cssSelectorAncestor:"#bottom",cssSelector:{title:".songtitle",play:"._control_play",seekBar:".__player_progress_seek",pause:"._control_pause",mute:"._mute",unmute:"._unmute"}})},loadContent:function(e){null!=doxhr&&void 0!=doxhr&&doxhr.abort(),console.log(e);var a=e.replace(".","_"),t=!1;switch(e){case"collections":e="all";break;case"songs":e="filter:songs";break;case"activity":e="filter:activity";break;case"mixes":e="filter:category.1";break;case"remixes":e="filter:category.2";break;case"ediciones":e="filter:category.3";break;case"sincategoria":e="filter:category.0";break;case"songs.all":e="filter:songs.all";break;case"songs.mixes":e="filter:songs.1";break;case"songs.remixes":e="filter:songs.2";break;case"songs.ediciones":e="filter:songs.3";break;case"songs.sincategoria":e="filter:songs.0"}switch(!0){case/songs\.user/.test(e):t=!0}e=t?"filter:"+e:e,console.log('._feed_container [data-content-filter="'+a+'"]',$('._feed_container [data-content-filter="'+a+'"]').length),e!=lastFilter&&$("._feed_container").empty();var l=e==lastFilter?$('._feed_container [data-content-filter="'+a+'"]').length:0;lastFilter=e;var o=12,n=$("._feed_container").hasClass("homepage")?!0:!1;doxhr=$.ajax({url:""+LMI.path+"../api.php?collections&view="+e+"&from="+l+"&to="+o,success:function(t){if(console.log(t),void 0!=t.status&&0==$('._feed_container [data-content-filter="'+a+'"]').length)$("._feed_container").empty().html('<p class="text-muted">No se encontraron datos.</p>'),$(".d-more-btn").hide();else{var l="";for(i=0;i<t.length;i++){if("song"==t[i].contenttype){var s="0:00";void 0!=t[i].audio_info&&null!=t[i].audio_info&&""!=t[i].audio_info&&(t[i].audio_info=jQuery.parseJSON(t[i].audio_info),s=void 0!=t[i].audio_info.Length_mmss?t[i].audio_info.Length_mmss:s),date_published=timeConverter(t[i].published),t[i].collection_id=null==t[i].collection_id?"__?":t[i].collection_id;var r="__?"==t[i].collection_id?"":t[i].collection.length>20?t[i].collection.substring(0,20)+"&hellip;":t[i].collection,c="__?"==t[i].collection_id?"":'<b>&bull;</b> <a href="'+LMI.link+"colecciones/coleccion/"+t[i].collection_id+'">'+r+"</a>",d=n?"col-xs-12 col-sm-12":"col-xs-12 col-sm-12",u=t[i].category;switch(t[i].category){case"0":u="sincategoria";break;case"1":u="mixes";break;case"2":u="remixes";break;case"3":u="ediciones";break;case"all":u="ediciones"}l+=(n?"":'<div class="col-xs-12 col-sm-6" data-content-type="songs">')+'<div data-content-filter="'+a+'" data-content-type="songs" class="'+d+" __feature_oi __content_song -song-"+t[i].id+'" '+'id="song-'+t[i].id+'" data-id="'+t[i].id+'"><div class="col-xs-12">'+'<div class="__feature_oi_cover" data-song-id="'+t[i].id+'"><div class="__feature_oi_info"><div class="__b_a">'+'<a href="javascript:;" class="pull-left play_song_in" '+'data-collection="'+t[i].collection_id+'" data-duration="'+s+'" '+'data-song-id="'+t[i].id+'" data-song-name="'+t[i].filename+'" '+'data-file="'+t[i].file+'" data-user-name="'+t[i].user_fullname+'" data-user-id="'+t[i].user_id+'"><i class="ion-play"></i><i class="ion-pause"></i></a>'+' &nbsp;<a href="'+LMI.link+"colecciones/song/"+t[i].id+'" class="song_name">'+t[i].filename+'</a><br /><h4><i class="ion-ios7-clock-outline"></i> '+s+"m "+c+' <b>&bull;</b> <span title="'+t[i].published+'" class="tooltip-t_ date_counter">'+date_published+'</span> <b>&bull;</b> <a href="'+LMI.link+"colecciones/#view/songs/"+u+'">'+LMI.values.categories[t[i].category]+"</a></h4></div></div>"+'<span class="clearfix"></span></div></div><div class="useful_information _noshow">'+'<input type="hidden" name="information__song__'+t[i].id+'" value="'+encodeURI(JSON.stringify(t[i]))+'" /></div></div>'+(n?"":"</div>")}if("collection"==t[i].contenttype){var d=n?"col-xs-6 col-sm-6 col-md-4":"col-xs-6 col-sm-4 col-md-3";l+='<div data-content-filter="'+a+'" data-content-type="collections" data-content-filter="'+a+'" class="'+d+' __feature_oi __content_collection"><div class="col-xs-12"><div class="__feature_oi_cover"><a href="'+LMI.link+"colecciones/coleccion/"+t[i].id+'"><div class="__feature_oi_img"><img src="'+LMI.path+"../usercontent/media/"+t[i].user_id+"/small_"+t[i].cover_url+'"></div></a><div class="__feature_oi_info"><a href="'+LMI.link+"colecciones/coleccion/"+t[i].id+'" class="__linker"></a><div class="__b_a"><small class="text-muted">'+t[i].numb+" canciones</small><br />"+t[i].name+"<br /><small>"+LMI.values.categories[t[i].category]+'</small><br /><span class="btn btn-trans btn-xs">LEER MAS</span></div></div></div></div></div>'}if("comment"==t[i].contenttype){date_published=timeConverter(t[i].published),t[i].content="0"==t[i].comment_content_type?'coment&oacute; una <a href="'+LMI.link+"colecciones/coleccion/"+t[i].comment_content_id+'" class="tooltip-t" title="ver colecci&oacute;n" data-placement="right">colecci&oacute;n</a>':'coment&oacute; una <a href="'+LMI.link+"colecciones/song/"+t[i].comment_content_id+'" class="tooltip-t" title="ver cancion" data-placement="right">canci&oacute;n</a>';var p=1==i%2?" _set_right":"",d=n?"col-xs-12 col-sm-12":"col-xs-12 col-sm-6";t[i].comment_body=t[i].comment_body.replace(/\n/g,"<br />"),l+='<div data-content-filter="'+a+'" data-content-type="activity" data-content-filter="'+a+'" class="'+d+" __feature_oi __content_song __content_comment -comment-"+t[i].id+p+'" '+'id="comment-'+t[i].id+'" data-id="'+t[i].id+'"><div class="col-xs-12">'+'<div class="__feature_oi_cover"><div class="__feature_oi_info"><div class="__b_a">'+'<div class="__hea">'+'<a href="'+LMI.link+"@"+t[i].user_username+'" class="pull-left user_photo">'+(null!=t[i].user_photo?'<img src="'+LMI.link+"usercontent/media/"+t[i].comment_user_id+"/"+t[i].user_photo+'" />':'<img src="'+LMI.link+'assets/image/_usr_pc.jpg" />')+"</a>"+'<a href="'+LMI.link+"@"+t[i].user_username+'" class="song_name">'+t[i].user_fullname+"</a> "+t[i].content+"</div> <p>"+urlify(t[i].comment_body)+"</p><h4>"+'publicado <span title="'+t[i].published+'" class="tooltip-t_ date_counter" data-placement="right" data-date="'+date_published+'">'+date_published+"</span> </h4></div></div>"+'<span class="clearfix"></span></div></div><div class="useful_information _noshow">'+'<input type="hidden" name="information__comment__'+t[i].id+'" value="'+encodeURI(JSON.stringify(t[i]))+'" /></div></div>'}}setTimeout(function(){$('._feed_container [data-content-filter="'+a+'"]').length>0&&e==lastFilter?$("._feed_container").append(l):$("._feed_container").empty().html(l),$("body").find("._pager").find('a[href="#view/'+a+'"]').parent().addClass("active").siblings().removeClass("active"),t.length>--o?$(".d-more-btn").show():$(".d-more-btn").hide()},10)}}})},init:function(){$("[data-toggle=offcanvas]").click(function(){$(".row-offcanvas").toggleClass("active")}),$("body .tooltip-t").tooltip(),$("body").on("click",".player-toggl",function(){null!=LMI.getCookie("LMI_playerVisible")&&""!=LMI.getCookie("LMI_playerVisible")&&"true"==LMI.getCookie("LMI_playerVisible")||playerVisible?(playerVisible=!1,LMI.setCookie("LMI_playerVisible","false",360)):(playerVisible=!0,LMI.setCookie("LMI_playerVisible","true",360)),$(this).toggleClass("ui-orange").parent().toggleClass("open active"),$(this).closest(".navbar").toggleClass("open"),$player.toggleClass("open"),$playerClone.toggleClass("open")}).on("click",".btn-close-modal",function(e){e.preventDefault(),e.stopPropagation(),$modal.modal("hide")}).on("click",".btn-new-modal",function(e){LMI.isMobile()||(e.preventDefault(),e.stopPropagation(),$(this).next(".login-drop").toggle())}).on("focus",".collection-item a",function(){$(this).closest(".collection-item").addClass("focus")}).on("blur",".collection-item a",function(){$(this).closest(".collection-item").removeClass("focus")}).on("click",".toggle_list_collection",function(e){e.preventDefault(),e.stopPropagation();var a=$(this).attr("data-status"),t=$(this).attr("data-collection"),i=$(this);LMI.fetchCollection(t,a,i),collection_open=collection_open?!1:!0,i.children(".c_info__").toggleClass("open"),$("._song_view_collection_list").toggleClass("open"),$("._song_view_collection_list").css({opacity:.98})}).on("keyup",function(e){27==e.keyCode&&collection_open&&($("body .toggle_list_collection").children(".c_info__").removeClass("open"),$("._song_view_collection_list").removeClass("open"),collection_open=!1,$("body").removeClass("modal-open"))}).on("click","._collection_togg",function(){$(this).toggleClass("open"),$(".collection_songs").toggle()}).on("click","._comment_box_submit",function(e){e.preventDefault(),e.stopPropagation(),$(this).hasClass("disabled")||($(this).button("loading"),LMI.postComment($(this)))}).on("click",".load-more-button a",function(){$(this).button("loading"),setTimeout(function(){LMI.fetchComments($("body").find(".activity_feed"))},100)}).on("click",".openaction",function(){$(".modal .modal-dialog").removeClass("modal-lg");var e=$(this).attr("data-id"),a=$(this).attr("data-action"),t=void 0!=$(this).attr("data-par")?$(this).attr("data-par"):"";$.ajax({url:""+LMI.path+"../user.interactions.php?profile&view="+e+"&do="+a+"&param="+t,success:function(e){$(".modal .modal-content").html(e),$(".modal").modal()}})}).on("click",".changeuname",function(){var e=$(this).attr("data-id"),a=$("#ousername"),t=$("#nusername"),i=$("#uerr");i.hide().addClass("alert-warning").removeClass("alert-info"),t.val()==a.val()?i.show().text("Deberias elegir un nombre distinto!"):validUsername(t.val())?$.ajax({url:LMI.link+"api.php?user&view="+t.val(),success:function(a){void 0!=a.status?(i.hide(),$.ajax({url:LMI.link+"user.interactions.php?profile&view="+e+"&do=saveuname&show="+t.val(),success:function(a){$(".modal .modal-content").html(a),$(".modal").modal(),setTimeout(function(){window.location=LMI.link+"@"+e+"/editar"},1e3)}})):i.show().text("Este nombre de usuario ya esta siendo usado.")}}):i.show().addClass("alert-info").removeClass("alert-warning").html("Nombre de usuario invalido! Los nombres de usuario solo deben contener letras (A-Z) y numeros (0-9). No se permiten caracteres adiciones, a excepcion de gui&oacute;n bajo (_).<br /><br /><a href=\"javascript:;\" onclick=\"$('#nusername').val('dj_win_' + (new String(Math.random(1,5)).replace('.','').substring(1,6)))\" class=\"button button-white\">Haz click aqui y te mostramos como</a>")}).on("click",".changecollectiondo",function(){var e=$(this).attr("data-id"),a=$("#ncollection");$.ajax({url:LMI.link+"user.interactions.php?profile&view="+e+"&do=savencollection&show="+a.val(),success:function(e){$(".modal .modal-content").html(e),$(".modal").modal(),Notifications.create("Cambios guardados. Se recargara la pagina en 1 segundo.",!0),setTimeout(function(){window.location.reload()},1e3)}})}).on("click",".changeupassword",function(){var e=$(this).attr("data-id"),a=$("#opassword"),t=$("#npassword"),i=$("#uerr");i.hide().addClass("alert-warning").removeClass("alert-info"),t.val()==a.val()||"Clave nueva"==t.val()||"Clave actual"==a.val()?i.show().text("Elige una clave diferente."):validPassword(t.val())?$.ajax({url:LMI.link+"api.php?user&view="+e+"&do=checkpass",type:"post",data:$(".modal :input").serialize(),success:function(e){console.log(e),void 0==e.status&&void 0!=e.id?(i.hide(),setTimeout(function(){window.location.reload()},1e3),console.log("clave correcta")):"nochanged"==e.status?i.show().text("Ha ocurrido un error durante el proceso."):i.show().text("Clave de usuario actual incorrecta.")}}):(i.show().addClass("alert-info").removeClass("alert-warning").html("Clave invalida! No puede contener caracteres especiales y debe tener entre 6 y 20 letras."),t.focus())}).on("click",".changeucountry",function(){var e=$(this).attr("data-id"),a=$("#ocountry"),t=$("#ncountry"),i=$("#uerr");i.hide().addClass("alert-warning").removeClass("alert-info"),t.val()==a.val()||""==t.val()?i.show().text("Elige un pais."):$.ajax({url:LMI.link+"api.php?user&view="+e+"&do=updatecountry",type:"post",data:$(".modal :input").serialize(),success:function(a){console.log(a),void 0==a.status?(i.hide(),setTimeout(function(){window.location=LMI.link+"@"+e+"/editar"},1e3)):"nochanged"==a.status?i.show().text("Ha ocurrido un error durante el proceso."):i.show().text("El pais no pudo ser cambiado.")}})}).on("click",".comment_cog",function(){$(".modal .modal-dialog").removeClass("modal-lg");var e=$(this).closest("li").attr("data-id"),a=$(this).closest("li").attr("data-content-type");$.ajax({url:""+LMI.path+"../user.interactions.php?comment_actions&view="+e+"&type="+a,success:function(e){$(".modal .modal-content").html(e),$(".modal").modal()}})}).on("click",".comment_actions a",function(){$(this).toggleClass("active").siblings().removeClass("active")}).on("click",".comment_actions_choose",function(){if($(this).closest(".modal").find(".comment_actions").find("a.active").length>0){$(this).button("loading");var e=$(this).closest(".modal").find(".comment_actions").find("a.active"),a=e.attr("data-action"),t=e.attr("data-comment-id"),i=e.attr("data-content-type");$.ajax({url:""+LMI.path+"../user.interactions.php?comment_actions&exec="+a+"&view="+t+"&type="+i,success:function(e){console.log(a,t,i),$(".modal .modal-content").html(e),e.indexOf("data-success-removing")>-1&&(console.log("removed"),$("body").find("#comment_"+t).remove())}})}else alert("Selecciona una accion antes de continuar")}).on("click",".comment_actions_send_flag",function(){console.log("Confirming flag comment");var e=$(this).closest(".comment_parent").find("textarea");if(e.closest(".comment_parent").find("._err").length>0&&e.closest(".comment_parent").find("._err").remove(),void 0!=e.val()&&null!=e.val()&&""!=e.val()){$(this).button("loading");var a=e.attr("data-content-type"),t=e.attr("data-comment-id"),i=e.serialize().replace("flag_c=","");$.ajax({url:""+LMI.path+"../user.interactions.php?comment_actions&exec=flag&confirm="+i+"&type="+a+"&view="+t,success:function(e){$(".modal .modal-content").html(e),console.log(e)}})}else e.closest(".comment_parent").find("._err").length>0?e.closest(".comment_parent").find("._err").html('<p class="text-danger">No puedes enviar un formulario vacio!</p>'):e.closest(".comment_parent").find(".form-group").after('<div class="_err"><p class="text-danger">No puedes enviar un formulario vacio!</p></div>')}).on("click",".collection_more a",function(){var e=$(this).attr("data-limit");$(this).button("loading");var a=$("._collections_l .__content_collection").length,t=$(this).attr("data-user"),l=$(this);$.ajax({url:""+LMI.path+"../api.php?collections&id="+t+"&from="+a+"&to="+e,success:function(a){if(console.log(a),void 0!=a.status)l.remove();else{var t="";for(i=0;i<a.length;i++)t+='<div class="col-xs-6 col-md-3 __feature_oi __content_collection"><div class="col-xs-12"><div class="__feature_oi_cover"><div class="__feature_oi_info"><a href="'+LMI.link+"colecciones/coleccion/"+a[i].id+'"><div class="__b_a" style="border-bottom: 1px solid #FCECEC;">'+a[i].name+"<br /><small>"+LMI.values.categories[a[i].category]+'</small></div></a><div style="margin: 7px; text-align: left"><a href="'+LMI.link+"colecciones/editar/coleccion-"+a[i].id+'" class="btn btn-default btn-xs">EDITAR</a>&nbsp;<a href="'+LMI.link+"colecciones/eliminar/coleccion-"+a[i].id+'" class="btn btn-cancel btn-xs pull-right">&times;</a></div><span class="clearfix"></span></div></div></div></div>';$("._collections_l").append(t),a.length<e?l.remove():l.button("reset")}}})}).on("click",".go-to-access",function(e){LMI.isMobile()||(e.preventDefault(),e.stopPropagation(),$(".btn-access").click(),$(window).scrollTop(0))}).on("click","._feed_listener li a",function(){var e=$(this).attr("href");console.log(e);var a=$(this),t=a.html();a.html('<img src="'+LMI.path+'image/preloader_small.gif" />'),a.parent().addClass("active").siblings().removeClass("active"),setTimeout(function(){a.html(t)},50)}).on("click","._togglenoflowlist",function(){var e=$(this);$("._noflowlist, ._noflowlist .mCustomScrollBox").animate({maxHeight:$("._noflowlist li").first().innerHeight()*$("._noflowlist li").length+2*$("._noflowlist li").length+"px"},300,function(){$("._noflowlist").css({overflow:"visible"}),e.remove()})}).on("click","._layer_toggle ul li a",function(e){e.preventDefault(),e.stopPropagation();var a=$(this).parent().index();$(this).parent().addClass("active").siblings().removeClass("active"),$("._layer").removeClass("active"),$("._layer").eq(a).addClass("active")}).on("click",".download",function(e){var a=$(this);if(a.hasClass("dl_____"))setTimeout(function(){a.attr("disabled","disabled").addClass("disabled").html('<i class="ion-checkmark-round"></i> descargado')},10);else{e.preventDefault(),e.stopPropagation();var t=$(this).attr("data-download"),i=30;if(!downloading){downloading=!0,a.button("loading").removeClass("btn-success").addClass("btn-cancel"),a.html('<i class="ion-ios7-clock-outline"></i> descarga en '+i);var l=setInterval(function(){i>0?(a.html('<i class="ion-ios7-clock-outline"></i> descarga en '+i),i--):(a.text("espera"),setTimeout(function(){clearInterval(l),a.html("click aqui para descargar").removeClass("btn-cancel").addClass("btn-warning").removeAttr("disabled","false").removeClass("disabled");var e=parseInt($(".downloads-number").text());e++,$(".downloads-number").html('<i class="ion-ios7-cloud-download-outline"></i> '+e),a.attr("href",t).attr("target","_blank").addClass("dl_____").removeAttr("disabled","false").removeClass("disabled")},500))},1e3)}}}).on("click touch",".play_song_in",function(){var e=$(this).attr("data-user-id"),a=$(this).attr("data-file"),t=$(this).attr("data-collection"),i=LMI.path+"../usercontent/media/"+e+"/"+a,l=$(this).attr("data-song-name"),o=$(this).attr("data-song-id"),n=$(this).attr("data-duration"),s=$(this).attr("data-user-id"),r=$(this).attr("data-user-name"),c=LMI.getCurrentSong();$(this).hasClass("playing")&&$(".player-footer").hasClass("playing")&&void 0!=c.url&&c.url==i?(LMI.player.set("pause"),$(".play_song_in").removeClass("playing"),isPlaying=i):(void 0!=c.url&&c.url==i&&$(".player-footer").hasClass("playing")?($(this).addClass("playing"),LMI.player.set("play")):(LMI.setSong(l,i,t,o,n,s,r),void 0!=c.url&&c.url==i?$(this).addClass("playing"):($(".play_song_in").removeClass("playing"),$(this).addClass("playing"))),isPlaying=i)}).on("click touch",".play-song, .songdata",function(){console.log("playing/pausing song");var e=$(this).closest("li"),a=(e.attr("data-user-id"),e.attr("data-collection")),t=e.attr("data-url"),i=e.attr("data-title"),l=e.attr("data-song-id"),o=e.attr("data-duration"),n=e.attr("data-user-id"),s=e.attr("data-user-name");if(e.hasClass("playing")&&$player.hasClass("playing"))LMI.player.set("pause"),isPlaying=t;else{if($(".player-toggl").parent().hasClass("open")||$(".player-toggl").trigger("click"),0!=isPlaying&&t==isPlaying)e.addClass("playing"),LMI.player.set("play");else{var r=LMI.getCurrentSong();LMI.setSong(i,t,a,l,o,n,s),void 0!=r.url&&r.url==t?e.addClass("playing"):($playlist.find("li").removeClass("playing"),e.addClass("playing"))}isPlaying=t}}).on("click touch",".remove-song",function(){var e=$(this).closest("li").index();console.log(e),playlist=LMI.playlist.getList(),playlist.songs.unpush(e),LMI.playlist.save(),$(".playlistplayer").first().find("li").eq(e).hasClass("playing")&&(LMI.player.set("stop"),$(".playlistplayer").first().find("li").eq(e).next("li").length>0?$(".playlistplayer").first().find("li").eq(e).next("li").find(".play-song").trigger("click"):$(".playlistplayer").first().find("li").eq(e).prev("li").length>0?$(".playlistplayer").first().find("li").eq(e).prev("li").find(".play-song").trigger("click"):LMI.player.set("stop")),$(".playlistplayer").each(function(){$(this).find("li").eq(e).remove()}),LMI.player.set("refresh"),Notifications.create("Track removida de la lista.")}).on("click","._control_next",function(){$playlist.find("li.playing").index()==$playlist.find("li").last().index()?$playlist.find("li").first().find(".play-song").trigger("click"):$playlist.find("li.playing").next("li").find(".play-song").trigger("click")}).on("click","._control_prev",function(){$playlist.find("li.playing").index()==$playlist.find("li").first().index()?$playlist.find("li").last().find(".play-song").trigger("click"):$playlist.find("li.playing").prev("li").find(".play-song").trigger("click")}).on("click",".toggle-playlist",function(){$player.toggleClass("playlistopen")}).on("click",".d-more-btn a",function(){var e=$(this);e.parent();var a=location.hash.slice(6).replace(/\//g,".");LMI.loadContent(a)}).on("click",".curchoice",function(e){e.preventDefault(),e.stopPropagation();var a=$(this);$(".chose").not(a.parent()).removeClass("open"),a.parent().toggleClass("open"),choseOpen[a.index()]=!0}).on("click","*",function(){$("body").find(".chose.open").length>0&&!$(this).hasClass("curchoice")&&$(".chose").removeClass("open")}).on("click",".chose ul li a",function(){var e=$(this),a=e.text();e.parent().addClass("active").siblings().removeClass("active"),e.closest(".chose").find(".curchoice").html(a+' <b class="caret text-muted"></b>')}).on("submit","#searchform",function(e){e.preventDefault(),e.stopPropagation();var a=encodeURI($("#searchquery").val());window.location.href=LMI.link+"colecciones/buscar/#view/buscar/"+a}).on("click",".remove-from-collection",function(){var e=jQuery(this).attr("data-id");confirm("Estas seguro de que quieres eliminar esta track?")&&(jQuery(this).closest("li").addClass("removing"),LMI.filemanager.removeSong(e))}),$("form").attr("autocomplete","off"),$("body").find(".toggle_list_collection").length>0&&setTimeout(function(){$(".toggle_list_collection").trigger("click")},500);var e=window.location.href.replace(window.location.protocol+LMI.link,"").replace(/\//g,"-").replace(/\#/g,"_hash_");if($("body").addClass(e).attr("data-action",e),$("body").find(".filemanager").length>0&&LMI.filemanager.init(),$("body").find("._coverflow").length>0&&$("body").find("._coverflow").find("li").length>0&&setTimeout(function(){$("body").find("._coverflow").show(),LMI.coverflow()},500),$("body").find(".__intro._affixer").length>0){var a=$("body").find(".__intro._affixer"),t=a.height();$("body").find("._affixer_clone").length>0?$("body").find("._affixer_clone").css({height:t+"px"}):a.after('<div class="__intro _affixer_clone" style="height: '+t+'px"></div>')}if($("body").find(".fetch_collections").length>0&&LMI.fetchCollections(),$("body").find(".activity_feed").length>0&&LMI.fetchComments($("body").find(".activity_feed")),$("body").find("._comment_box").length>0){var l=$("body").find("._comment_box").find("._comment_text");l.attr("data-original-value",l.val())}if($("._pager_tabs li").last().addClass("last"),LMI.initPlayer(),LMI.isMobile()?$(".__scrollable_w,.__scrollable_wx, .__scrollable_b, .__scrollable_md").css({overflowY:"scroll"}):($(".__scrollable_w").mCustomScrollbar({theme:"light-3",scrollInertia:0}),$(".__scrollable_wx").mCustomScrollbar({axis:"x",theme:"minimal",scrollInertia:0}),$(".__scrollable_b").mCustomScrollbar({theme:"dark-3",scrollInertia:0}),$(".__scrollable_md").mCustomScrollbar({theme:"minimal-dark",scrollInertia:0})),$("body").find("[data-reload-timer]").length>0){var o=$("[data-reload-timer]").attr("data-reload-timer"),o=parseInt(o);setTimeout(function(){window.location.reload()},o)}LMI.playlist.gen(),LMI.player.volumerController(),carouselInstance=$("#carousel-image-and-text").touchCarousel({pagingNav:!1,snapToItems:!1,itemsPerMove:2,scrollToLast:!1,loopItems:!1,scrollbar:!0}).data("touchCarousel"),$("#carousel-image-and-text").length>0&&0==$("#carousel-image-and-text").find("li").length&&$("#carousel-image-and-text").hide(),$("body").hasClass("notfound")||$(".loadingNotif").css({display:"inherit"}),jQuery("._col_cover_big,.backstretch_image").length>0&&jQuery("._col_cover_big, .backstretch_image").each(function(){jQuery(this).backstretch(jQuery(this).attr("data-image"))}),jQuery(".collection_edition").length>0&&LMI.loadEditionCollections(),jQuery(".nav-tabs").length>0&&jQuery("body").on("click",".nav-tabs a",function(e){e.preventDefault(),e.stopPropagation();var a=jQuery(this).closest("li");a.addClass("active").siblings().removeClass("active"),jQuery(".tab-content .tab-pane").eq(a.index()).addClass("active").siblings().removeClass("active")})}},$(document).on("ready",function(){if(LMI.init(),$("body").find(".toggle_list_collection").length>0){var e=$("body").find(".toggle_list_collection");e.attr("data-status"),e.attr("data-collection")}else $loader.removeClass("loading");Pace.on("hide",function(){$("._st_load").removeClass("loading")});var a=function(){$("body").find('[data-attach="true"]').length>0&&$("body").find('[data-attach="true"]').find("li").first().find("a").trigger("click")},t=function(e){console.log("viewBook: bookId is populated: "+e)},i=function(e){LMI.loadContent(e),$("body").removeClass("showsongs"),$("body").find('[data-attach="true"]').length>0&&$("body").find('[data-attach="true"]').each(function(){$(this).find('a[href*="#view/'+e+'"]').trigger("click")})},l=function(e,a){"buscar"==e?(LMI.loadContent("filter:buscar."+a),$("#searchquery").val(decodeURI(a))):LMI.loadContent(e+"."+a),$("body").addClass("showsongs"),$("body").find('[data-attach="true"]').length>0&&$("body").find('[data-attach="true"]').each(function(){$(this).find('a[href*="#view/'+e+'/"]').trigger("click"),$(this).find('a[href*="#view/'+e+"/"+a+'"]').trigger("click")})},o=function(e){LMI.loadContent("filter:buscar."+e),$("#searchquery").val(decodeURI(e))},n={"/":a,"/tab":a,"/tab/:bookId":t,"/view/:bookId":i,"/view/:bookId/:book2Id":l,"/view/buscar/([^/]*)":function(e){o(e)}},s=Router(n);s.init()}).ajaxStart(function(){$("._st_load").addClass("loading"),Pace.restart()}).ajaxComplete(function(){$("._st_load").removeClass("loading"),setTimeout(function(){$("body .tooltip-t").tooltip(),$(".date_counter").streamdate()},500)});